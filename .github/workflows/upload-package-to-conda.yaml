name: Upload Conda Package

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  build-and-upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Sets up the Conda environment needed for the build action
      - name: Setup Miniconda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-update-conda: true
          python-version: "3.11" # Adjust to match your project's python version

      - name: Build and Upload to Anaconda
        uses: uibcdf/action-build-and-upload-conda-packages@v2.0.0
        with:
          # IMPORTANT: Point this to the directory containing your meta.yaml file
          # Common convention is a folder named 'conda', 'recipe', or '.' if in root
          meta_yaml_dir: ./conda 
          
          # Replace with your Anaconda user or organization name
          user: davidusb
          
          # This token must be added to your GitHub repository secrets
          token: ${{ secrets.ANACONDA_TOKEN }}
          
          # Optional: Overwrite if the version already exists
          overwrite: false